{% extends "base.html" %}

{% block title %}Job Details - {{ job[2] }} at {{ job[1] }}{% endblock %}

{% block content %}
<div class="card">
    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem;">
        <h2><i class="fas fa-briefcase"></i> Job Details</h2>
        <a href="{{ url_for('student_dashboard') }}" class="btn btn-info btn-sm">
            <i class="fas fa-arrow-left"></i> Back to Dashboard
        </a>
    </div>

    <div style="display: grid; gap: 2rem;">
        <!-- Job Header -->
        <div class="job-header" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 2rem; border-radius: 10px;">
            <h1 style="margin: 0; font-size: 2rem;">{{ job[2] }}</h1>
            <h3 style="margin: 0.5rem 0 0 0; opacity: 0.9;">{{ job[1] }}</h3>
        </div>

        <!-- Job Information Grid -->
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 2rem;">
            <!-- Left Column -->
            <div>
                <div class="info-section">
                    <h3><i class="fas fa-info-circle"></i> Job Information</h3>
                    <div class="info-grid">
                        <div class="info-item">
                            <strong><i class="fas fa-money-bill-wave"></i> Salary Package:</strong>
                            <span>â‚¹{{ "{:,.0f}".format(job[5]) if job[5] else 'Not disclosed' }}</span>
                        </div>
                        <div class="info-item">
                            <strong><i class="fas fa-map-marker-alt"></i> Location:</strong>
                            <span>{{ job[4] or 'Location not specified' }}</span>
                        </div>
                        <div class="info-item">
                            <strong><i class="fas fa-briefcase"></i> Job Type:</strong>
                            <span>{{ job[9] or 'Full-time' }}</span>
                        </div>
                        <div class="info-item">
                            <strong><i class="fas fa-calendar-alt"></i> Application Deadline:</strong>
                            <span style="color: #dc3545; font-weight: bold;">{{ job[10].strftime('%d %B %Y') if job[10] else 'No deadline' }}</span>
                        </div>
                    </div>
                </div>

                <div class="info-section">
                    <h3><i class="fas fa-graduation-cap"></i> Eligibility Requirements</h3>
                    <div class="info-grid">
                        <div class="info-item">
                            <strong><i class="fas fa-star"></i> Minimum CGPA:</strong>
                            <span>{{ job[7] }}</span>
                        </div>
                        <div class="info-item">
                            <strong><i class="fas fa-user-check"></i> Your CGPA:</strong>
                            <span class="{% if student_profile and student_profile[5] and (student_profile[5]|float) >= (job[7]|float) %}cgpa-eligible{% else %}cgpa-not-eligible{% endif %}">
                                {{ student_profile[5] if student_profile else 'N/A' }}
                                {% if student_profile and student_profile[5] and (student_profile[5]|float) >= (job[7]|float) %}
                                    <i class="fas fa-check-circle"></i>
                                {% else %}
                                    <i class="fas fa-times-circle"></i>
                                {% endif %}
                            </span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Right Column -->
            <div>
                <div class="info-section">
                    <h3><i class="fas fa-tools"></i> Required Skills</h3>
                    <div class="skills-container">
                        {% if job[8] %}
                            {% for skill in job[8].split(',') %}
                                <span class="skill-tag">{{ skill.strip() }}</span>
                            {% endfor %}
                        {% else %}
                            <p style="color: #666;">No specific skills mentioned</p>
                        {% endif %}
                    </div>
                </div>

                <div class="info-section">
                    <h3><i class="fas fa-building"></i> Company Information</h3>
                    <div class="company-info">
                        {% if company %}
                            <p><strong>About:</strong> {{ company[6] if company[6] else 'No description available' }}</p>
                            {% if company[4] %}
                                <p><strong>Website:</strong> <a href="{{ company[4] }}" target="_blank">{{ company[4] }}</a></p>
                            {% endif %}
                            {% if company[3] %}
                                <p><strong>Contact:</strong> {{ company[3] }}</p>
                            {% endif %}
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>

        <!-- Job Description -->
        <div class="info-section">
            <h3><i class="fas fa-file-alt"></i> Job Description</h3>
            <div class="job-description">
                {{ job[3] if job[3] else 'No detailed description available.' }}
            </div>
        </div>

        <!-- Eligibility Criteria -->
        {% if job[6] %}
        <div class="info-section">
            <h3><i class="fas fa-list-check"></i> Detailed Eligibility Criteria</h3>
            <div class="eligibility-criteria">
                {{ job[6] }}
            </div>
        </div>
        {% endif %}

        <!-- Application Section -->
        <div class="application-section" style="background: #f8f9fa; padding: 2rem; border-radius: 10px; border-left: 5px solid #667eea;">
            <h3><i class="fas fa-paper-plane"></i> Apply for this Job</h3>
            
            {% set already_applied = applications|selectattr('2', 'equalto', job[2])|list %}
            {% if already_applied %}
                <div style="text-align: center; padding: 2rem;">
                    <i class="fas fa-check-circle" style="font-size: 3rem; color: #28a745; margin-bottom: 1rem;"></i>
                    <h4 style="color: #28a745;">Already Applied!</h4>
                    <p>You have already submitted your application for this position.</p>
                    <p><strong>Application Status:</strong> <span class="status-badge status-{{ already_applied[0][5].lower() }}">{{ already_applied[0][5] }}</span></p>
                </div>
            {% elif student_profile and student_profile[5] and (student_profile[5]|float) >= (job[7]|float) %}
                <form method="POST" action="{{ url_for('apply_for_job_detailed', job_id=job[0]) }}" enctype="multipart/form-data">
                    <div class="form-group">
                        <label for="cover_letter"><i class="fas fa-envelope"></i> Cover Letter (Optional):</label>
                        <textarea name="cover_letter" id="cover_letter" rows="4" class="form-control" 
                                  placeholder="Write a brief cover letter explaining why you're interested in this position..."></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label for="resume"><i class="fas fa-file-upload"></i> Upload Resume (Required):</label>
                        <input type="file" name="resume" id="resume" class="form-control" 
                               accept=".pdf,.doc,.docx" required>
                        <small class="form-text text-muted">Accepted formats: PDF, DOC, DOCX (Max 5MB)</small>
                    </div>
                    
                    <div style="text-align: center; margin-top: 2rem;">
                        <button type="submit" class="btn btn-success" style="padding: 1rem 2rem; font-size: 1.1rem;"
                                onclick="return confirm('Are you sure you want to apply for this job? Make sure you have uploaded your latest resume.')">
                            <i class="fas fa-paper-plane"></i> Submit Application
                        </button>
                    </div>
                </form>
            {% else %}
                <div style="text-align: center; padding: 2rem;">
                    <i class="fas fa-exclamation-triangle" style="font-size: 3rem; color: #ffc107; margin-bottom: 1rem;"></i>
                    <h4 style="color: #856404;">CGPA Requirement Not Met</h4>
                    <p>You need a minimum CGPA of <strong>{{ job[7] }}</strong> to apply for this position.</p>
                    <p>Your current CGPA: <strong>{{ student_profile[5] if student_profile else 'N/A' }}</strong></p>
                </div>
            {% endif %}
        </div>
    </div>
</div>

<style>
.info-section {
    margin-bottom: 2rem;
}

.info-section h3 {
    color: #333;
    border-bottom: 2px solid #667eea;
    padding-bottom: 0.5rem;
    margin-bottom: 1rem;
}

.info-grid {
    display: grid;
    gap: 1rem;
}

.info-item {
    display: flex;
    justify-content: space-between;
    padding: 0.75rem;
    background: #f8f9fa;
    border-radius: 5px;
    border-left: 3px solid #667eea;
}

.skills-container {
    display: flex;
    flex-wrap: wrap;
    gap: 0.5rem;
}

.skill-tag {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    padding: 0.5rem 1rem;
    border-radius: 20px;
    font-size: 0.9rem;
    font-weight: 500;
}

.job-description, .eligibility-criteria {
    background: white;
    padding: 1.5rem;
    border-radius: 5px;
    border: 1px solid #e9ecef;
    line-height: 1.6;
}

.company-info {
    background: white;
    padding: 1.5rem;
    border-radius: 5px;
    border: 1px solid #e9ecef;
}

.company-info a {
    color: #667eea;
    text-decoration: none;
}

.company-info a:hover {
    text-decoration: underline;
}

.status-badge {
    padding: 0.25rem 0.75rem;
    border-radius: 15px;
    font-size: 0.85rem;
    font-weight: 600;
    text-transform: uppercase;
}

.status-applied { background: #cce5ff; color: #0066cc; }
.status-shortlisted { background: #fff3cd; color: #856404; }
.status-selected { background: #d4edda; color: #155724; }
.status-rejected { background: #f8d7da; color: #721c24; }

.cgpa-eligible {
    color: #28a745;
    font-weight: bold;
}

.cgpa-not-eligible {
    color: #dc3545;
    font-weight: bold;
}
</style>
{% endblock %}