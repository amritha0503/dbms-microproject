{% extends "base.html" %}

{% block title %}Manage Applications{% endblock %}

{% block content %}
<div class="content-card">
    <h2>Manage Applications & Interview Scheduling</h2>
    
    {% if applications %}
        <table class="table">
            <thead>
                <tr>
                    <th>Student</th>
                    <th>Job</th>
                    <th>Current Round</th>
                    <th>Overall Status</th>
                    <th>Date</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                {% for app in applications %}
                <tr>
                    <td>{{ app[1] }}</td>
                    <td>{{ app[5] }}</td>
                    <td>
                        <span class="badge badge-info">{{ app[8] or 'Applied' }}</span>
                    </td>
                    <td>
                        {% if app[13] == 'Selected' %}
                            <span class="badge badge-success">{{ app[13] }}</span>
                        {% elif app[13] == 'Rejected' %}
                            <span class="badge badge-danger">{{ app[13] }}</span>
                        {% else %}
                            <span class="badge badge-primary">{{ app[13] or 'Active' }}</span>
                        {% endif %}
                    </td>
                    <td>{{ app[6] }}</td>
                    <td>
                        <!-- Resume Download -->
                        {% if app[9] and app[9].strip() %}
                        {% set filename = app[9].split('/')[-1].split('\\')[-1] %}
                        <a href="{{ url_for('download_resume', filename=filename) }}" class="btn btn-sm btn-info" title="Download Resume">📄 Resume</a>
                        {% else %}
                        <span class="text-muted">No Resume</span>
                        {% endif %}
                        
                        <!-- Screening Rounds (Round 1 & 2) - Pass/Fail Updates -->
                        {% if app[13] not in ['Selected', 'Rejected'] %}
                        <div class="btn-group-vertical" style="margin-top: 5px;">
                            <a href="{{ url_for('update_screening_round', app_id=app[0]) }}?round=Round1" class="btn btn-sm btn-info">� Round 1 Result</a>
                            <a href="{{ url_for('update_screening_round', app_id=app[0]) }}?round=Round2" class="btn btn-sm btn-info">� Round 2 Result</a>
                        </div>
                        
                        <!-- Interview Scheduling (Technical & HR) -->
                        <div class="btn-group-vertical" style="margin-top: 5px;">
                            <a href="{{ url_for('schedule_interview', app_id=app[0]) }}?round=Technical" class="btn btn-sm btn-warning">� Technical Interview</a>
                            <a href="{{ url_for('schedule_interview', app_id=app[0]) }}?round=HR" class="btn btn-sm btn-success">� HR Interview</a>
                        </div>
                        {% endif %}
                        
                        <!-- Status Update Buttons -->
                        <div class="btn-group-vertical" style="margin-top: 5px;">
                            <a href="{{ url_for('update_application_status', app_id=app[0], status='Shortlisted') }}" class="btn btn-sm btn-warning">✓ Shortlist</a>
                            <a href="{{ url_for('update_application_status', app_id=app[0], status='Selected') }}" class="btn btn-sm btn-success">✅ Select</a>
                            <a href="{{ url_for('update_application_status', app_id=app[0], status='Rejected') }}" class="btn btn-sm btn-danger">❌ Reject</a>
                        </div>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    {% else %}
        <p>No applications found.</p>
    {% endif %}
</div>

<style>
.badge {
    padding: 4px 8px;
    border-radius: 4px;
    font-size: 0.8em;
    color: white;
}
.badge-info { background-color: #17a2b8; }
.badge-success { background-color: #28a745; }
.badge-danger { background-color: #dc3545; }
.badge-primary { background-color: #007bff; }
.btn-group-vertical { display: flex; flex-direction: column; gap: 2px; }
</style>
{% endblock %}
